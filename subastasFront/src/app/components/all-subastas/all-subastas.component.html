<div class="subastas-container">
  <!-- Sidebar de filtros -->
  <aside class="filter-sidebar">
    <div class="filter-header">
      <h2>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
        </svg>
        Filtros
      </h2>
      <button class="btn-reset" (click)="limpiarFiltros()" title="Limpiar filtros">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
          <path d="M3 3v5h5" />
        </svg>
        Limpiar
      </button>
    </div>

    <!-- Búsqueda -->
    <div class="filter-section">
      <label class="filter-label">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        Buscar
      </label>
      <input type="text" class="filter-input" placeholder="Buscar por título o ubicación..." [(ngModel)]="busqueda"
        (ngModelChange)="onBusquedaChange()" />
    </div>

    <!-- Estado -->
    <div class="filter-section">
      <label class="filter-label">Estado</label>
      <div class="radio-group">
        <label class="radio-option">
          <input type="radio" name="estado" [checked]="estadoSeleccionado === 'ACTIVA'"
            (change)="activarFiltroEstado('ACTIVA')" />
          <span class="radio-custom"></span>
          <span class="radio-text">Activas</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="estado" [checked]="estadoSeleccionado === 'PENDIENTE'"
            (change)="activarFiltroEstado('PENDIENTE')" />
          <span class="radio-custom"></span>
          <span class="radio-text">Pendientes</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="estado" [checked]="estadoSeleccionado === 'FINALIZADA'"
            (change)="activarFiltroEstado('FINALIZADA')" />
          <span class="radio-custom"></span>
          <span class="radio-text">Finalizadas</span>
        </label>
      </div>
    </div>

    <!-- Rango de precio -->
    <div class="filter-section">
      <label class="filter-label">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="1" x2="12" y2="23" />
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
        </svg>
        Rango de precio
      </label>
      <div class="price-inputs">
        <input type="number" class="filter-input filter-input-small" placeholder="Mín" [(ngModel)]="precioMin"
          (ngModelChange)="onPrecioChange()" min="0" />
        <span class="price-separator">-</span>
        <input type="number" class="filter-input filter-input-small" placeholder="Máx" [(ngModel)]="precioMax"
          (ngModelChange)="onPrecioChange()" min="0" />
      </div>
    </div>

    <!-- Ordenamiento -->
    <div class="filter-section">
      <label class="filter-label">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18M7 12h10m-7 6h4" />
        </svg>
        Ordenar por
      </label>
      <select class="filter-select" [(ngModel)]="ordenamiento" (ngModelChange)="onOrdenamientoChange()">
        <option value="fecha-desc">Más recientes</option>
        <option value="fecha-asc">Más antiguas</option>
        <option value="precio-asc">Menor precio</option>
        <option value="precio-desc">Mayor precio</option>
      </select>
    </div>

    <!-- Contador de resultados -->
    <div class="results-count">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" />
      </svg>
      <span>{{ subastasFiltradas.length }} resultado{{ subastasFiltradas.length !== 1 ? 's' : '' }}</span>
    </div>
  </aside>

  <!-- Contenido principal -->
  <main class="main-content">
    <!-- Header -->
    <div class="content-header">
      <div>
        <h1 class="page-title">
          @if (categoria) {
          {{ categoria }}
          } @else {
          {{ title }}
          }
        </h1>
        <p class="page-subtitle">
          Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} -
          {{ min(currentPage * itemsPerPage, subastasFiltradas.length) }}
          de {{ subastasFiltradas.length }} subastas
        </p>
      </div>
    </div>

    <!-- Loading state -->
    @if (isLoading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando subastas...</p>
    </div>
    }

    <!-- Empty state -->
    @if (!isLoading && subastasFiltradas.length === 0) {
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8" />
        <path d="m21 21-4.35-4.35" />
        <line x1="11" y1="8" x2="11" y2="14" />
        <line x1="8" y1="11" x2="14" y2="11" />
      </svg>
      <h3>No se encontraron subastas</h3>
      <p>Intenta ajustar los filtros o busca con otros términos</p>
      <button class="btn-reset-large" (click)="limpiarFiltros()">
        Limpiar filtros
      </button>
    </div>
    }

    <!-- Grid de subastas -->
    @if (!isLoading && subastasFiltradas.length > 0) {
    <div class="subastas-grid">
      @for (item of subastasPaginadas; track item.id) {
      <article class="subasta-card">
        <div class="card-image-container">
          <img [src]="item.imagenes[0]" [alt]="item.title" class="card-image" />
          <span class="card-badge" [class.badge-activa]="item.estado === 'ACTIVA'"
            [class.badge-pendiente]="item.estado === 'PENDIENTE'"
            [class.badge-finalizada]="item.estado === 'FINALIZADA'">
            {{ item.estado }}
          </span>
        </div>

        <div class="card-body">
          <h3 class="card-title">{{ item.title | slice:0:30 }}{{ item.title.length > 30 ? '...' : '' }}</h3>

          <div class="card-details">
            <p class="card-location">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                <circle cx="12" cy="10" r="3" />
              </svg>
              {{ item.ubicacion }}{{ item.ubicacion ? '' : 'Ubicación no especificada' }}
            </p>
            <p class="card-date">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 6v6l4 2" />
              </svg>
              Finaliza: {{ item.fechaFin | date:'dd/MM/yyyy HH:mm' }}
            </p>
          </div>

          <div class="card-footer">
            <div class="price-section">
              <span class="price-label">Precio inicial</span>
              <span class="price-value">$ {{ item.precioInicial | number:'1.0-0' }}</span>
            </div>
            <button [routerLink]="['/subasta/' + item.id]" class="btn-view">
              Ver detalles
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7" />
              </svg>
            </button>
          </div>
        </div>
      </article>
      }
    </div>

    <!-- Paginación mejorada -->
    @if (totalPages > 1) {
    <nav class="pagination" aria-label="Navegación de páginas">
      <button class="pagination-btn pagination-btn-prev" (click)="cambiarPagina(currentPage - 1)"
        [disabled]="currentPage === 1" aria-label="Página anterior">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6" />
        </svg>
        Anterior
      </button>

      <div class="pagination-numbers">
        @for (page of paginasVisibles; track page) {
        @if (page === -1) {
        <span class="pagination-ellipsis">...</span>
        } @else {
        <button class="pagination-number" [class.active]="currentPage === page" (click)="cambiarPagina(page)"
          [attr.aria-current]="currentPage === page ? 'page' : null">
          {{ page }}
        </button>
        }
        }
      </div>

      <button class="pagination-btn pagination-btn-next" (click)="cambiarPagina(currentPage + 1)"
        [disabled]="currentPage === totalPages" aria-label="Página siguiente">
        Siguiente
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6" />
        </svg>
      </button>
    </nav>
    }
    }
  </main>
</div>